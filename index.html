<!doctype html>
<html>
  <head>
  	<meta charset="utf-8"/>
  	<title>React Mentions</title>
  	<link rel="stylesheet" type="text/css" href="lib/styles.css"/>
  	<style type="text/css">
  		body {
  			color: #222;
  			font-family: "Helvetica Neue", sans-serif;
  			font-weight: 200;
  			margin: 0 50px;
  		}
  	</style>
  </head>
  <body>
    <script src="https://fb.me/react-with-addons-0.12.1.js"></script>
    <script src="https://fb.me/JSXTransformer-0.12.1.js"></script>
    <script src="dist/react-mentions.js"></script>
    <script type="text/jsx">
      /** @jsx React.DOM */
      var MentionsInput = ReactMentions.MentionsInput;
      var Mention = ReactMentions.Mention;


      var users = [
        {
          id: "johndoe",
          display: "John Doe"
        },
        {
          id: "joesmoe",
          display: "Joe Smoe"
        }
      ];

      var App = React.createClass({
        getInitialState: function() {
          return {
            value: "Hi @[John Doe](user:johndoe), \n\nlet's add @[joe@smoe.com](email:joe@smoe.com) and @[John Doe](user:johndoe) to this conversation... ",
            valueSingleLine: "Hi @[John Doe](user:johndoe)!",
            emailsCount: 0
          };
        },

        render: function() {

          // use first/outer capture group to extract the full entered sequence to be replaced
          // and second/inner capture group to extract search string from the match
          var emailRegex = /(([^\s@]+@[^\s@]+\.[^\s@]+))$/;

          return (
            <div>
              <h1>React Mentions Input</h1>


              <h3>Multiple trigger patterns</h3>
              <p>Mention people using '@' + username or type an email address</p>

              <MentionsInput value={this.state.value} onChange={this.handleChange} markup="@[__display__](__type__:__id__)">
                <Mention
                  type="user"
                  trigger="@"
                  data={users}
                  renderSuggestion={this.renderSuggestion}
                  onAdd={this.handleAdd}
                  onRemove={this.handleRemove} />
                <Mention
                  type="email"
                  trigger={emailRegex}
                  data={this.requestEmail}
                  onAdd={this.handleEmailAdd} />
              </MentionsInput>

              <h3>Single line input</h3>

              <MentionsInput singleLine={true} value={this.state.valueSingleLine} onChange={this.handleChangeSingleLine}>
                <Mention data={users} />
              </MentionsInput>

            </div>
          );
        },

        handleChange: function(ev, value) {
          this.setState({ value: value });
        },

        handleChangeSingleLine: function(ev, value) {
          this.setState({ valueSingleLine: value });
        },

        requestEmail: function(search) {
          return [
            { id: search, display: search }
          ];
        },

        renderSuggestion: function(match, search) {
          return (
            <div className="user">
              <img src={"img/" + match.id + ".png"} />
              { match.display }
            </div>
          );
        },

        handleAdd: function() {
          console.log("added a new mention", arguments);
        },

        handleRemove: function() {
          console.log("removed a mention", arguments);
        }

        //handleEmailAdd: function(email) {
        //  this.setState({ emailsCount: this.state.emailsCount+1 });
        //}

      });

      React.render(<App/>, document.body);
    </script>
  </body>
</html>
